package com.chalkdigital.spark;


import android.content.pm.ActivityInfo;
import android.support.annotation.NonNull;
import android.support.annotation.Nullable;

import com.chalkdigital.ads.CDAdErrorCode;
import com.chalkdigital.ads.resource.DrawableConstants;
import com.chalkdigital.common.CDAdDeviceInfo;
import com.chalkdigital.common.DataKeys;
import com.chalkdigital.common.util.DeviceUtils;
import com.chalkdigital.common.util.Utils;
import com.chalkdigital.interstitial.ads.ResponseBodyInterstitial;
import com.chalkdigital.interstitial.ads.SparkActivity;
import com.chalkdigital.network.response.TypeParser;

import java.util.HashMap;
import java.util.Map;

import static com.chalkdigital.common.DataKeys.HTML_RESPONSE_BODY_KEY;

public class SparkInterstitial extends ResponseBodyInterstitial {
    @Nullable
    protected String mHtmlData;

    @Override
    protected void extractExtras(Map<String, String> serverExtras) {
        mHtmlData = serverExtras.get(HTML_RESPONSE_BODY_KEY);
//        mHtmlData = "<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?><VAST version=\"2.0\">  <Ad id=\"1222\">  <Wrapper>    <AdSystem>Chalk Digital</AdSystem>    <VASTAdTagURI><![CDATA[http://bs.serving-sys.com/Serving?cn=display&c=23&pl=VAST&pli=24850877&PluID=0&pos=2406&ord=1530628219551&cim=1]]></VASTAdTagURI>    <Creatives><Creative AdID=\"5370\"><Linear><TrackingEvents><Tracking event=\"start\"><![CDATA[http://api.cdange.mobi/xp/evt?srid=30aaf28c-cafe-46ee-a30d-5dfb4a5afc20&osrid=5e89cfe8-6c01-4b45-b16a-465fca642a27&t=1530628219&pubid=0cf8d6d643e13d86a5b6374148a4afac&impid=5e89cfe8-6c01-4b45-b16a-465fca642a27&cip=122.180.156.222&cid=1222&crid=5370&b=chalkdigital.com&c=IND&wh=1024x768&zoneid=&dealid=&dspid=3&imptype=video&ua=Mozilla%2F5.0+%28Macintosh%3B+Intel+Mac+OS+X+10_13_5%29+AppleWebKit%2F537.36+%28KHTML%2C+like+Gecko%29+Chrome%2F67.0.3396.99+Safari%2F537.36&carrier=&ct=Gurgaon&st=10&z=122001&bek=8007bf23744378521215359079a071ed_20180703_14&le=0&userid=f7cb80deabd81735905a6275c7f76172707d7159&bidid=30aaf28c-cafe-46ee-a30d-5dfb4a5afc20&ifa=&m=1&act=6]]></Tracking><Tracking event=\"start\"><![CDATA[http://google.com]]></Tracking><Tracking event=\"start\"><![CDATA[http://api.cdange.mobi/xp/evt?pp=1azzyNzfJS7Cou8TA2WNzVuQL0ydzUwJIBPGlMVPGLpoxbLAhZmIUGZhdPHZB5AyynvHSwumo6QaQfWIpxAZ1eAwxCUEXLmnvwqJuAbiLiCYYhfPmx5JELM1KqqLsOF8yv1pbWmsu2uQS0KKx8ymF9vXg1xUJdjT7tv8osYeljQ83OME6K6c7JinERpWHa7JIKTcUAeUBKhlqlGVlC0Y7QOD8eJsWyEBkmrFI5BglTRqKaR2yL1NnVbLT9YQMhCEFPZrmmq51UEsyKQ4J71QLUPnHkxKuEhrRa6WWsF54SBT662Q70lLW8HVCSLefDUsKIgpCiVRofAK7akpUAFMBKMs74M2JBIjyIAlmWKJgCUjH5CL38JSJ8LdCki8vi85edKFohgwEMXVpRFr9cyFzAU3B04Kp8BxtxjGgNUA1z5A81be45pZdiYzL9wlOxVjv2lLsjqKSMD3qk28Bnv1qedKF6m1rCWfY95GMyUp9iHsoltnkjq4UrMZHh6f8nU6i9CF6DILKJdil0lslXbtK5ucZAecLLCkNqCK0O3zcmxJiHskB1qEo3NRhbgYARDVnzhWsLwEijx0DiGpRsEEsyAK9zc71B1qg04WwzoTngCxOfo8zEGMRifdVQcyHI8lfv5aMINxqJmfixMvLyKpV2cde2LpdeT53O57zTug7SpuMMMCionMa6DVhi4SBQsXbcCK5Rp1yT50kIe8etvwEmC9DH7iszPU5830o4eZj0ZTddGOEJ09ZVxpV6g0iekz1BKMaVslcYdvtt4KaueiDLwHsinwEYd5N4p0sE54Gi7Fn16ysI14EhQexWmUzthCpAzStelP86k1E3QaeloRnctMMjvDuVbzgzwTPe9oyj44pl6O6hDJahgAFqy4UEmEoRcUiPgqFkAo2iQNOa77LBQ89gISODPUSqJa1PQ2LA7spWZx4ZZE__]]></Tracking><Tracking event=\"firstQuartile\"><![CDATA[http://api.cdange.mobi/xp/evt?srid=30aaf28c-cafe-46ee-a30d-5dfb4a5afc20&osrid=5e89cfe8-6c01-4b45-b16a-465fca642a27&t=1530628219&pubid=0cf8d6d643e13d86a5b6374148a4afac&impid=5e89cfe8-6c01-4b45-b16a-465fca642a27&cip=122.180.156.222&cid=1222&crid=5370&b=chalkdigital.com&c=IND&wh=1024x768&zoneid=&dealid=&dspid=3&imptype=video&ua=Mozilla%2F5.0+%28Macintosh%3B+Intel+Mac+OS+X+10_13_5%29+AppleWebKit%2F537.36+%28KHTML%2C+like+Gecko%29+Chrome%2F67.0.3396.99+Safari%2F537.36&carrier=&ct=Gurgaon&st=10&z=122001&bek=8007bf23744378521215359079a071ed_20180703_14&le=0&userid=f7cb80deabd81735905a6275c7f76172707d7159&bidid=30aaf28c-cafe-46ee-a30d-5dfb4a5afc20&ifa=&m=1&act=7]]></Tracking><Tracking event=\"firstQuartile\"><![CDATA[http://google.com]]></Tracking><Tracking event=\"midpoint\"><![CDATA[http://api.cdange.mobi/xp/evt?srid=30aaf28c-cafe-46ee-a30d-5dfb4a5afc20&osrid=5e89cfe8-6c01-4b45-b16a-465fca642a27&t=1530628219&pubid=0cf8d6d643e13d86a5b6374148a4afac&impid=5e89cfe8-6c01-4b45-b16a-465fca642a27&cip=122.180.156.222&cid=1222&crid=5370&b=chalkdigital.com&c=IND&wh=1024x768&zoneid=&dealid=&dspid=3&imptype=video&ua=Mozilla%2F5.0+%28Macintosh%3B+Intel+Mac+OS+X+10_13_5%29+AppleWebKit%2F537.36+%28KHTML%2C+like+Gecko%29+Chrome%2F67.0.3396.99+Safari%2F537.36&carrier=&ct=Gurgaon&st=10&z=122001&bek=8007bf23744378521215359079a071ed_20180703_14&le=0&userid=f7cb80deabd81735905a6275c7f76172707d7159&bidid=30aaf28c-cafe-46ee-a30d-5dfb4a5afc20&ifa=&m=1&act=8]]></Tracking><Tracking event=\"midpoint\"><![CDATA[http://google.com]]></Tracking><Tracking event=\"thirdQuartile\"><![CDATA[http://api.cdange.mobi/xp/evt?srid=30aaf28c-cafe-46ee-a30d-5dfb4a5afc20&osrid=5e89cfe8-6c01-4b45-b16a-465fca642a27&t=1530628219&pubid=0cf8d6d643e13d86a5b6374148a4afac&impid=5e89cfe8-6c01-4b45-b16a-465fca642a27&cip=122.180.156.222&cid=1222&crid=5370&b=chalkdigital.com&c=IND&wh=1024x768&zoneid=&dealid=&dspid=3&imptype=video&ua=Mozilla%2F5.0+%28Macintosh%3B+Intel+Mac+OS+X+10_13_5%29+AppleWebKit%2F537.36+%28KHTML%2C+like+Gecko%29+Chrome%2F67.0.3396.99+Safari%2F537.36&carrier=&ct=Gurgaon&st=10&z=122001&bek=8007bf23744378521215359079a071ed_20180703_14&le=0&userid=f7cb80deabd81735905a6275c7f76172707d7159&bidid=30aaf28c-cafe-46ee-a30d-5dfb4a5afc20&ifa=&m=1&act=9]]></Tracking><Tracking event=\"thirdQuartile\"><![CDATA[http://google.com]]></Tracking><Tracking event=\"complete\"><![CDATA[http://api.cdange.mobi/xp/evt?srid=30aaf28c-cafe-46ee-a30d-5dfb4a5afc20&osrid=5e89cfe8-6c01-4b45-b16a-465fca642a27&t=1530628219&pubid=0cf8d6d643e13d86a5b6374148a4afac&impid=5e89cfe8-6c01-4b45-b16a-465fca642a27&cip=122.180.156.222&cid=1222&crid=5370&b=chalkdigital.com&c=IND&wh=1024x768&zoneid=&dealid=&dspid=3&imptype=video&ua=Mozilla%2F5.0+%28Macintosh%3B+Intel+Mac+OS+X+10_13_5%29+AppleWebKit%2F537.36+%28KHTML%2C+like+Gecko%29+Chrome%2F67.0.3396.99+Safari%2F537.36&carrier=&ct=Gurgaon&st=10&z=122001&bek=8007bf23744378521215359079a071ed_20180703_14&le=0&userid=f7cb80deabd81735905a6275c7f76172707d7159&bidid=30aaf28c-cafe-46ee-a30d-5dfb4a5afc20&ifa=&m=1&act=10]]></Tracking><Tracking event=\"complete\"><![CDATA[http://google.com]]></Tracking><Tracking event=\"close\"><![CDATA[http://api.cdange.mobi/xp/evt?srid=30aaf28c-cafe-46ee-a30d-5dfb4a5afc20&osrid=5e89cfe8-6c01-4b45-b16a-465fca642a27&t=1530628219&pubid=0cf8d6d643e13d86a5b6374148a4afac&impid=5e89cfe8-6c01-4b45-b16a-465fca642a27&cip=122.180.156.222&cid=1222&crid=5370&b=chalkdigital.com&c=IND&wh=1024x768&zoneid=&dealid=&dspid=3&imptype=video&ua=Mozilla%2F5.0+%28Macintosh%3B+Intel+Mac+OS+X+10_13_5%29+AppleWebKit%2F537.36+%28KHTML%2C+like+Gecko%29+Chrome%2F67.0.3396.99+Safari%2F537.36&carrier=&ct=Gurgaon&st=10&z=122001&bek=8007bf23744378521215359079a071ed_20180703_14&le=0&userid=f7cb80deabd81735905a6275c7f76172707d7159&bidid=30aaf28c-cafe-46ee-a30d-5dfb4a5afc20&ifa=&m=1&act=11]]></Tracking></TrackingEvents><VideoClicks><ClickTracking><![CDATA[http://api.cdange.mobi/xp/evt?pp=7dYhlg3gubA5UAxjoB0rE1KIf5eb5yr8S1nZJAy7aP2jAfWb6i823kSjISPhZwTKVYZpsDOJsrIvPSDnlnx5LCGN0pXxYX7NyZzd2konzIiDlHT7UJQcGMlYJgAFqE83Ln2s2O7OWzAJNC9fGUsX6oyHl2QLwd0ufA70AG0o0cX4kN4KVuHxR25ZaCX9LyEQmZOHYG7ndrIBcBhalqKAmzWI7puk815aJ2snUELgdPdKj9b1WfR6h92sf798787ffKGwi9zCtUFKU6uWnNMcp7UmEl5RpO39J2wfBeKGJuKd5XkZp2ITzZloVGk8RmkYw8JLVqBPxGvFXStu2wUeBR0j5N4SSLZXTtMbKa9UZwIVy2W3iwsPVFrUR3UaqdvvmFVlYubK5vzdesKCNjKkR75xkwQcJVrwLHa1BD20ysOUHMPIBRuvgjRKGDgn3FE6N2FOUJ69N766g3sF91NKxrLVsAHdmDTrWLQnuo3Jrrh9mUKEVwboPqUsUCShhwDKukNskCgLQopdiTpiTnKUiUtFCPXMh37CWQGmBDwTCPUySE5YSmaRPiIhUoWK5U0lRd4ZOLxTTSW0bbvbQaZraB3te6wgy2ZF2qjHOslwg1szV5PFNnizyFtGsidds5r4CKOR2jxGG98dpWr7AZolnutCtAIwG28OCMSJy7zRlykeJgRamxRwsFQbT93WAPkuvVeRgzyNhUBrirZX4cvhaIwBswSg4SLsAybYwhnXKSShPRMew2vZRAjvK6Gypq8W6iUTQZat71tkd2IGxfRLADoI7XyZ7S4WPfDkO3Hm549aI4QaGYtazq8ntas9vzsaFG335oJj8rTCxHtZ2kGlhv3QJnNxiwsnrzpE33hIW08DwLfKIEP0WnlEyumFxxeBFUxlOj1wEMsbWKsWdAQvpF__]]></ClickTracking></VideoClicks></Linear></Creative></Creatives>  <Impression><![CDATA[http://api.cdange.mobi/xp/evt?srid=30aaf28c-cafe-46ee-a30d-5dfb4a5afc20&osrid=5e89cfe8-6c01-4b45-b16a-465fca642a27&t=1530628219&pubid=0cf8d6d643e13d86a5b6374148a4afac&impid=5e89cfe8-6c01-4b45-b16a-465fca642a27&cip=122.180.156.222&cid=1222&crid=5370&b=chalkdigital.com&c=IND&wh=1024x768&zoneid=&dealid=&dspid=3&imptype=video&ua=Mozilla%2F5.0+%28Macintosh%3B+Intel+Mac+OS+X+10_13_5%29+AppleWebKit%2F537.36+%28KHTML%2C+like+Gecko%29+Chrome%2F67.0.3396.99+Safari%2F537.36&carrier=&ct=Gurgaon&st=10&z=122001&bek=8007bf23744378521215359079a071ed_20180703_14&le=0&userid=f7cb80deabd81735905a6275c7f76172707d7159&bidid=30aaf28c-cafe-46ee-a30d-5dfb4a5afc20&ifa=&m=1&act=5]]></Impression></Wrapper>  </Ad></VAST>";
//        mHtmlData = "<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\" standalone=\\\"no\\\"?><VAST version=\\\"2.0\\\"><Ad id=\\\"4863\\\"><InLine><AdSystem>Programatic OpenRTB<\\/AdSystem><AdTitle>General Vast<\\/AdTitle><Creatives><Creative AdID=\\\"4863\\\"><Linear><Duration>00:00:15<\\/Duration><TrackingEvents><Tracking event=\\\"start\\\"><![CDATA[https:\\/\\/api.cdange.mobi\\/xp\\/evt?srid=74a31a60-0d4b-4318-88f5-399535258f91&osrid=9269a8c1-cb1e-455a-95ca-f75e7fff7f00&t=1531053537&pubid=0cf8d6d643e13d86a5b6374148a4afac&plmt=0&impid=1&cip=106.202.169.107&cid=1222&crid=4863&b=com.pandora.android&c=IND&wh=320x480&zoneid=&dealid=&dspid=3&imptype=video&ua=Mozilla%2F5.0+%28Linux%3B+Android+6.0.1%3B+ZUK+Z2132+Build%2FMMB29M%3B+wv%29+AppleWebKit%2F537.36+%28KHTML%2C+like+Gecko%29+Version%2F4.0+Chrome%2F67.0.3396.87+Mobile+Safari%2F537.36&carrier=Vodafone+IN&ct=Karnal&st=HR&z=132001&bek=7d8d4517f0480b3f661b1ce5bff147dd_20180708_12&le=0&userid=0b9176c4-975b-4c80-8abf-c0f7e2bd2b85&bidid=74a31a60-0d4b-4318-88f5-399535258f91&ifa=0b9176c4-975b-4c80-8abf-c0f7e2bd2b85&m=1&act=6]]><\\/Tracking><Tracking event=\\\"start\\\"><![CDATA[https:\\/\\/api.cdange.mobi\\/xp\\/evt?pp=MxS8aNN86GTZbLnASHyuDPinMPK72MvWPcyeW75GxtSMivRPHSROM81amop7dPaEd4VYRslAHvHgYtroKsD54zF25CEnwu976wFd5RHYVFGI68Li64t4kuI8n2KzfN6nVFITrWP7qjTqa55iVHz2tmkgPXKhHMA4lW4pWr2g1ZZ9sTvRH44SkhlQwaulO3BBIgyEqfHc1xHnmdr4RLm0XylJmyaWivqUyQ3bz6FLfLdsemULWJkkpN7JRxBY2Kcb6O79z7iukrpKDTQOEJP6KNOjUHx2SvRlyhDPyEkuV7ax6RlGpdRarRQzkn7WhcTbbuHpbuCbRSxcMjshvxYnfru7nwb4tqDkKkbHV19Hb42H84wec0RaaOk5DOGgiJJ5ZRxzerk8At0uuVhCRndAQQcPV9IVajgBzQ8FEZkOIgYvXh2S8RizQJsVcR7ztfSQ9GkqtQsSVRrobHuHLydjpGXhg3Y5fascfhDJtXlFOQC2q2bg33lPFiNbHQV6Gm6W1xQl4RZY1hMsGDUAin6ZgTxtz2PARG7xBQmA1GVtOwA5gsm64Ix9JT5pzWJq1kA5iRbW0R2k9HOYQPN8SMF6UUbwvrgUc0Bgwfe283qJNVBEpYsOMVCme880yokn8izCaDXdkGWlnf4OnKvK3xG2I150C5vicFb0aWU7rfJEE0jT81MU4IyKXRMCug3XqthO6md20WTcOcsaW7h7aYA305GfrFRPauj4lFZt3IgmPi00kThOGFsLGZI6ZnjstDpryS9aQDUVNtBCGZIDSjWOhMZyKSiSAL6zdK4OC0PYfxXZP9I0hhK9Tjv7XHD4r3HA9GlEG0jaItx9fYw9zZ9eXcvlrxhik0aM8x80dthqHzqLqaEKbqdGi38zdyJ4XoFBt5VKuDIV1QDa6A60SiNlYGxmF4MhmB9eRHDiPsNjnsb6koziNTpZEOenc0t6alZ4te2NL4BWFi5fsdDEGe__]]><\\/Tracking><Tracking event=\\\"firstQuartile\\\"><![CDATA[https:\\/\\/api.cdange.mobi\\/xp\\/evt?srid=74a31a60-0d4b-4318-88f5-399535258f91&osrid=9269a8c1-cb1e-455a-95ca-f75e7fff7f00&t=1531053537&pubid=0cf8d6d643e13d86a5b6374148a4afac&plmt=0&impid=1&cip=106.202.169.107&cid=1222&crid=4863&b=com.pandora.android&c=IND&wh=320x480&zoneid=&dealid=&dspid=3&imptype=video&ua=Mozilla%2F5.0+%28Linux%3B+Android+6.0.1%3B+ZUK+Z2132+Build%2FMMB29M%3B+wv%29+AppleWebKit%2F537.36+%28KHTML%2C+like+Gecko%29+Version%2F4.0+Chrome%2F67.0.3396.87+Mobile+Safari%2F537.36&carrier=Vodafone+IN&ct=Karnal&st=HR&z=132001&bek=7d8d4517f0480b3f661b1ce5bff147dd_20180708_12&le=0&userid=0b9176c4-975b-4c80-8abf-c0f7e2bd2b85&bidid=74a31a60-0d4b-4318-88f5-399535258f91&ifa=0b9176c4-975b-4c80-8abf-c0f7e2bd2b85&m=1&act=7]]><\\/Tracking><Tracking event=\\\"midpoint\\\"><![CDATA[https:\\/\\/api.cdange.mobi\\/xp\\/evt?srid=74a31a60-0d4b-4318-88f5-399535258f91&osrid=9269a8c1-cb1e-455a-95ca-f75e7fff7f00&t=1531053537&pubid=0cf8d6d643e13d86a5b6374148a4afac&plmt=0&impid=1&cip=106.202.169.107&cid=1222&crid=4863&b=com.pandora.android&c=IND&wh=320x480&zoneid=&dealid=&dspid=3&imptype=video&ua=Mozilla%2F5.0+%28Linux%3B+Android+6.0.1%3B+ZUK+Z2132+Build%2FMMB29M%3B+wv%29+AppleWebKit%2F537.36+%28KHTML%2C+like+Gecko%29+Version%2F4.0+Chrome%2F67.0.3396.87+Mobile+Safari%2F537.36&carrier=Vodafone+IN&ct=Karnal&st=HR&z=132001&bek=7d8d4517f0480b3f661b1ce5bff147dd_20180708_12&le=0&userid=0b9176c4-975b-4c80-8abf-c0f7e2bd2b85&bidid=74a31a60-0d4b-4318-88f5-399535258f91&ifa=0b9176\n" +
//                "    c4-975b-4c80-8abf-c0f7e2bd2b85&m=1&act=8]]><\\/Tracking><Tracking event=\\\"thirdQuartile\\\"><![CDATA[https:\\/\\/api.cdange.mobi\\/xp\\/evt?srid=74a31a60-0d4b-4318-88f5-399535258f91&osrid=9269a8c1-cb1e-455a-95ca-f75e7fff7f00&t=1531053537&pubid=0cf8d6d643e13d86a5b6374148a4afac&plmt=0&impid=1&cip=106.202.169.107&cid=1222&crid=4863&b=com.pandora.android&c=IND&wh=320x480&zoneid=&dealid=&dspid=3&imptype=video&ua=Mozilla%2F5.0+%28Linux%3B+Android+6.0.1%3B+ZUK+Z2132+Build%2FMMB29M%3B+wv%29+AppleWebKit%2F537.36+%28KHTML%2C+like+Gecko%29+Version%2F4.0+Chrome%2F67.0.3396.87+Mobile+Safari%2F537.36&carrier=Vodafone+IN&ct=Karnal&st=HR&z=132001&bek=7d8d4517f0480b3f661b1ce5bff147dd_20180708_12&le=0&userid=0b9176c4-975b-4c80-8abf-c0f7e2bd2b85&bidid=74a31a60-0d4b-4318-88f5-399535258f91&ifa=0b9176c4-975b-4c80-8abf-c0f7e2bd2b85&m=1&act=9]]><\\/Tracking><Tracking event=\\\"complete\\\"><![CDATA[https:\\/\\/api.cdange.mobi\\/xp\\/evt?srid=74a31a60-0d4b-4318-88f5-399535258f91&osrid=9269a8c1-cb1e-455a-95ca-f75e7fff7f00&t=1531053537&pubid=0cf8d6d643e13d86a5b6374148a4afac&plmt=0&impid=1&cip=106.202.169.107&cid=1222&crid=4863&b=com.pandora.android&c=IND&wh=320x480&zoneid=&dealid=&dspid=3&imptype=video&ua=Mozilla%2F5.0+%28Linux%3B+Android+6.0.1%3B+ZUK+Z2132+Build%2FMMB29M%3B+wv%29+AppleWebKit%2F537.36+%28KHTML%2C+like+Gecko%29+Version%2F4.0+Chrome%2F67.0.3396.87+Mobile+Safari%2F537.36&carrier=Vodafone+IN&ct=Karnal&st=HR&z=132001&bek=7d8d4517f0480b3f661b1ce5bff147dd_20180708_12&le=0&userid=0b9176c4-975b-4c80-8abf-c0f7e2bd2b85&bidid=74a31a60-0d4b-4318-88f5-399535258f91&ifa=0b9176c4-975b-4c80-8abf-c0f7e2bd2b85&m=1&act=10]]><\\/Tracking><Tracking event=\\\"close\\\"><![CDATA[https:\\/\\/api.cdange.mobi\\/xp\\/evt?srid=74a31a60-0d4b-4318-88f5-399535258f91&osrid=9269a8c1-cb1e-455a-95ca-f75e7fff7f00&t=1531053537&pubid=0cf8d6d643e13d86a5b6374148a4afac&plmt=0&impid=1&cip=106.202.169.107&cid=1222&crid=4863&b=com.pandora.android&c=IND&wh=320x480&zoneid=&dealid=&dspid=3&imptype=video&ua=Mozilla%2F5.0+%28Linux%3B+Android+6.0.1%3B+ZUK+Z2132+Build%2FMMB29M%3B+wv%29+AppleWebKit%2F537.36+%28KHTML%2C+like+Gecko%29+Version%2F4.0+Chrome%2F67.0.3396.87+Mobile+Safari%2F537.36&carrier=Vodafone+IN&ct=Karnal&st=HR&z=132001&bek=7d8d4517f0480b3f661b1ce5bff147dd_20180708_12&le=0&userid=0b9176c4-975b-4c80-8abf-c0f7e2bd2b85&bidid=74a31a60-0d4b-4318-88f5-399535258f91&ifa=0b9176c4-975b-4c80-8abf-c0f7e2bd2b85&m=1&act=11]]><\\/Tracking><\\/TrackingEvents><VideoClicks><ClickThrough><![CDATA[https:\\/\\/google.com]]><\\/ClickThrough><ClickTracking><![CDATA[https:\\/\\/api.cdange.mobi\\/xp\\/evt?pp=6ej7IFWnA2HHbBuyo7gLrTVmjN8mSkf5azlX9SrfWhoNq2Yo1tu7zuC6MyfFYKYUT5W3yrmwCKIwJ8I5npibSuNwKwp0JHnjT0EQbUc1PUidDu80SECNIVuVvIUtkTh5Cz0wjjjEYj4VMwy0GCrjtcQlZX3rIPliDV8gd5tLwn1CHQS9FySb4VVolNS8RmtOLCoKcAgbIx2YUPFacZATlFnB0DJJduyW5uFYFSwtAwMTihhwtW2YBWw4CESBk0j3cNilWXH9CQC5G8BnERTcNNI3ylCmUfhA89gBjnCdImyiOkUivoZP4MnFydsHwnwrl1YeaUFZkN2HzAKOscJHMhzqZqusu14UBDoJIWXrc1omoIJumxJHRgWYN972EHj31fJi0AgGEGY5tVzJoUdQW6FYWf1IyTjOADHzFGUNZFcNfIQWQT5ssNhEFP7306kvuddE8vmmPMp45lyZvCZMsDxsWpMI4vMTf5YWWSmCrZFcfCV1trHxvlOtg4a7qLXost4xSY2o7fVLDcpZwZ4nTPxX102LVqOykOr9AWNpDtz9yZsBZYTAEhx7eien7DvkuBZGFDu72HexMiEFjAKmZNIlobnZO1Rn56XTXib1sxMnDW0OCSmv167VR4glLxO9k8uaRdRQGycY4prNmJ7WmmdPkTwPEk2BII7ULmZhkY1Z2r9V9gnfrwqdiCe1inCHLXcitV5ybZND9IDAF9NCP2DeVEShEzIgFMaBMyZZ2ISRjRYCFMzsKwpOf3wRLbBjL4yWYudckdC9ljulZZRM4FjkK7n0nTMEwvdNdHhjyKencM7l2BCeUho1AvmuJ6uZT969tqojKsj2y9hk4x1nKjMimuQgbiJwyKzBIQboYU0L2dk48gQ2QKY8MjuWpHNenABszuJNVSpOx74kaVywUviPPQhrrafOjKwMUtoJQrYIx5ug6pkKDZSNKs5Oz__]]><\\/ClickTracking><\\/VideoClicks><MediaFiles><MediaFile apiFramework=\\\"\\\" delivery=\\\"progressive\\\" height=\\\"480\\\" type=\\\"video\\/mp4\\\" width=\\\"640\\\"><![CDATA[https:\\/\\/daf37cpxaja7f.cloudfront.net\\/c1222\\/15238361223730_Espinosa_2nd_Amendment.mp4]]><\\/MediaFile><\\/MediaFiles><\\/Linear><\\/Creative><\\/Creatives><Impression><![CDATA[https:\\/\\/api.cdange.mobi\\/xp\\/evt?srid=74a31a60-0d4b-4318-88f5-399535258f91&osrid=9269a8c1-cb1e-455a-95ca-f75e7fff7f00&t=1531053537&pubid=0cf8d6d643e13d86\n" +
//                "    a5b6374148a4afac&plmt=0&impid=1&cip=106.202.169.107&cid=1222&crid=4863&b=com.pandora.android&c=IND&wh=320x480&zoneid=&dealid=&dspid=3&imptype=video&ua=Mozilla%2F5.0+%28Linux%3B+Android+6.0.1%3B+ZUK+Z2132+Build%2FMMB29M%3B+wv%29+AppleWebKit%2F537.36+%28KHTML%2C+like+Gecko%29+Version%2F4.0+Chrome%2F67.0.3396.87+Mobile+Safari%2F537.36&carrier=Vodafone+IN&ct=Karnal&st=HR&z=132001&bek=7d8d4517f0480b3f661b1ce5bff147dd_20180708_12&le=0&userid=0b9176c4-975b-4c80-8abf-c0f7e2bd2b85&bidid=74a31a60-0d4b-4318-88f5-399535258f91&ifa=0b9176c4-975b-4c80-8abf-c0f7e2bd2b85&m=1&act=5]]><\\/Impression><\\/InLine><\\/Ad><\\/VAST>";
        mHtmlData = mHtmlData.replace(System.getProperty("line.separator"), "");
    }

    @Override
    protected void preRenderHtml(final @NonNull CustomEventInterstitialListener
            customEventInterstitialListener, final Map<String, String> serverExtras) {
        Utils.getSavedVpaidHTML(serverExtras.get(DataKeys.VPAID_SOURCE_URL), mContext, new Utils.VpaidSourceListener() {
            @Override
            public void onSuccess(final String html) {
                preRenderVpaidHtml(html, customEventInterstitialListener, serverExtras);
            }

            @Override
            public void onFailure() {
                customEventInterstitialListener.onInterstitialFailed(
                        CDAdErrorCode.VPAID_SOURCE_URL_ERROR);
                return;
            }
        });
    }

    protected void preRenderVpaidHtml(final String vpaidHtml, @NonNull CustomEventInterstitialListener
                                         customEventInterstitialListener, Map<String, String> serverExtras) {
        int orientation = TypeParser.parseInteger(serverExtras.get(DataKeys.CREATIVE_ORIENTATION_KEY), ActivityInfo.SCREEN_ORIENTATION_PORTRAIT);
        int width = CDAdDeviceInfo.deviceInfo(mContext).getW();
        int height = CDAdDeviceInfo.deviceInfo(mContext).getH();
        if (orientation!= DeviceUtils.getScreenOrientation(mContext) && orientation != ActivityInfo.SCREEN_ORIENTATION_UNSPECIFIED){
            int temp = height;
            height = width;
            width = temp;
        }
        mHtmlData = vpaidHtml.replace("vast_response", mHtmlData).replace("ad_width", width+"").replace("ad_height", height+"").replace("timer_bottom_margin", DrawableConstants.CtaButton.HEIGHT_DIPS+DrawableConstants.CtaButton.MARGIN_DIPS+"px");
        SparkActivity.preRenderHtml(this, mContext, customEventInterstitialListener, mHtmlData,
                mBroadcastIdentifier, mServerExtras);
    }

    @Override
    public void showInterstitial() {
        SparkActivity.start(mContext, mAdReport, mHtmlData, mBroadcastIdentifier, mServerExtras);
    }
}
